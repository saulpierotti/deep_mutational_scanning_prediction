\cleardoublepage%
\begin{appendices}
	% I want to use the letter S
	\setcounter{chapter}{19}%
	\chapter*{Supplementary material}%
	\addcontentsline{toc}{chapter}{Supplementary Material}%

	\begin{figure}[h!]
		\ffigbox[\FBwidth]{\input{./tikz/aa2_frequencies_by_dataset.tex}}{%
			\caption[Fraction of mutations towards a given residue, by dataset]{%
				\textbf{Fraction of mutations towards a given residue, by dataset.}
				Series of bar plots that represent the fraction of mutations towards each of the 20 standard residues, grouped by dataset.
				The orange dashed lines mark the expected fraction of mutations in the case of uniform frequency.
				For most datasets the distribution is uniform and no mutation is privileged.
				In the dataset \texttt{kka2\_1:2} mutations towards isoleucine, tyrosine, serine, asparagine, and glutamate are overrepresented.
			}\label{sup:fig:aa2_frequencies_by_dataset.tex}%
		}%
	\end{figure}

	\begin{figure}
		\ffigbox[\FBwidth]{\input{./tikz/score_distribution_by_dataset.tex}}{%
			\caption[Distribution of fitness scores, by dataset]{%
				\textbf{Distribution of fitness scores, by dataset.}
				Series of overlapping kernel density estimates (Gaussian kernel, bandwidth according to~\textcite{Sheather1991} adjusted with a multiplicative factor of \num{5}, showing \num{512} estimation points) and histograms (\num{100} bins) showing the distribution of the fitness scores for the datasets used in this work.
				To facilitate comparisons, the fitness scores were scaled independently for each dataset to the range \numrange{0}{1} and centred such that a neutral mutation would have a scaled score of \num{0}.
				The probability density was normalized to have a maximum value of \num{1} (and not a total area of \num{1}).
				The vertical axis is expressed in terms of normalized probability density also for the histogram.
				All of the datasets seem to have a more or less pronounced bimodal distribution.
				A strong skew towards negative fitness scores is present.
				Neutral effects are by far the most frequent, followed by smaller density peaks in the detrimental effect region.
				The dataset \texttt{beta-lactamase} shows a possible sensitivity artifact at the extreme negative end.
			}\label{sup:fig:score_distribution_by_dataset}%
		}%
	\end{figure}

	\begin{figure}
		\ffigbox[\FBwidth]{\input{./tikz/datasets_composition_by_dataset.tex}}{%
			\caption[Wild-type residue composition of each dataset compared to the wild-type protein sequence and the residue composition of UniProt]{%
				\textbf{Wild-type residue composition of each dataset compared to the wild-type protein sequence and the residue composition of UniProt.}
				The composition of the respective datasets in terms of wild-type residues for each mutation is shown in grey, the residue composition of the wild-type sequence of the mutagenized protein region is shown in orange, and the composition of the whole UniProt is shown in blue.
				The UniProt composition refers to the release 2020\_01, sourced from \url{https://www.uniprot.org/statistics/}.
			}\label{sup:fig:dataset_composition_by_dataset}%
		}%
	\end{figure}

	\begin{figure}
		\ffigbox[\FBwidth]{\input{./tikz/median_residue_fitness_by_dataset.tex}}{%
			\caption[Median score of mutations to and from each residue type, grouped by dataset]{%
				\textbf{Median score of mutations to and from each residue type, grouped by dataset.}
				Orange dots represent the median score of mutations from the residue.
				Black dots represent the median score of mutations towards the residue.
				For this visualization, the fitness scores were scaled independently for each dataset to the range \numrange{0}{1} and centered such that a neutral mutation would have a scaled score of \num{0}.
				Scaling was applied before calculating the medians.
			}\label{sup:fig:median_residue_fitness_by_dataset}%
		}%
	\end{figure}

	\begin{figure}
		\ffigbox[\FBwidth]{\input{./tikz/coverage_by_position_by_dataset.tex}}{%
			\caption[Mutagenesis coverage along the primary protein sequence for each experiment]{%
				\textbf{Mutagenesis coverage along the primary protein sequence for each experiment.}
				Series of stacked bar plots showing the number of mutations covering a given position along the primary sequence of each of the mutagenized proteins.
				The number of synonymous mutations is in orange and the number of missense mutations is in grey.
				Most experiments cover uniformly the respective mutagenized regions with \num{19} missense mutations, covering almost the full mutational landscape of the sequence.
				The dataset \texttt{E1\_Ubiquitin} is missing all the mutations at position \numrange{40}{48} (UniProt numbering).
				The dataset \texttt{hsp90} is missing all the mutations at position \numrange{212}{222} (UniProt numbering).
				Synonymous mutations are available only for a limited region in \texttt{Pab1} and are absent from some of the datasets.
				\texttt{WW\_domain} has a lower coverage compared to other datasets, not sampling the full mutational landscape of the protein.
				See \cref{sec:minor_inconsistencies} for a discussion about the missing positions.
			}\label{sup:fig:coverage_by_position_by_dataset}%
		}%
	\end{figure}

	\begin{figure}
		\ffigbox[\FBwidth]{\input{./tikz/mutation_identity_by_dataset.tex}}{%
			\caption[Average fitness score for each possible mutation, by dataset]{%
				\textbf{Average fitness score for each possible mutation, by dataset.}

				Series of heatmaps showing the average scaled fitness score for mutations towards and from any of the 20 standard residue types, for each dataset used in this study.
				Fitness scores were scaled to make them more comparable across datasets.
				Scaling was done on a per-dataset basis bringing the scores to the range \numrange{0}{1} and subtracting the scaled value for a score of \num{0}.
				Positive values indicate favoured mutations, negative values indicate damaging mutations, and a value of \num{0} indicates a mutation that has a neutral effect.
				Mutations that are not observed in the dataset are in grey.
			}\label{sup:fig:mutation_identity_by_dataset}%
		}%
	\end{figure}

	\begin{figure}
		\ffigbox[\FBwidth]{\input{./tikz/score_dssp_q3_by_dataset.tex}}{%
			\caption[Fitness score distribution by secondary structure, by dataset]{%
				\textbf{Fitness score distribution by secondary structure, by dataset.}
				Series of violin plots showing the distribution of median scaled fitness scores according to the secondary structure of the mutated position for each dataset used in this work.
				Fitness scores were scaled to make them more comparable across datasets.
				Scaling was done on a per-dataset basis bringing the scores to the range \numrange{0}{1} and subtracting the scaled value for a raw score of \num{0}.
				The median of the scaled fitness scores was taken by protein position and dataset.
				Only the subset of protein positions with an experimental secondary structure assignment is shown.
				The assignments were obtained as explained in \cref{sec:mm_exp_val}.

			}\label{sup:fig:score_dssp_q3_by_dataset}%
		}%
	\end{figure}

	\begin{figure}
		\ffigbox[\FBwidth]{\input{./tikz/score_dssp_rsa_by_dataset.tex}}{%
			\caption[Fitness score distribution by relative solvent accessibility, by dataset]{%
				\textbf{Fitness score distribution by relative solvent accessibility, by dataset.}
				Series of scatter plots showing the dependency between the experimental relative solvent accessibility of a mutated position and its median scaled fitness score.
				Fitness scores were scaled to make them more comparable across datasets.
				Scaling was done on a per-dataset basis bringing the scores to the range \numrange{0}{1} and subtracting the scaled value for a raw score of \num{0}.
				The median of the scaled fitness scores was taken by protein position and dataset.
			}\label{sup:fig:score_dssp_rsa_by_dataset}%
		}%
	\end{figure}

	\begin{figure}
		\ffigbox[\textwidth]{%
			\begin{subfloatrow}
				\ffigbox[\FBwidth]{\input{./tikz/single_protein_models_naive_test_result_summary.tex}}{\caption{}\label{sup:subfig:test_summary_naive}}
				\hfill%
				\ffigbox[\FBwidth]{\input{./tikz/single_protein_models_by_position_test_result_summary.tex}}{\caption{}\label{sup:subfig:test_summary_by_position}}
			\end{subfloatrow}
			\subfigvsep%
			\begin{subfloatrow}
				\ffigbox[\FBwidth]{\input{./tikz/lopo_xgb_models_test_result_summary.tex}}{\caption{}\label{sup:subfig:test_summary_lopo_xgb}}
				\hfill%
				\ffigbox[\FBwidth]{\input{./tikz/lopo_linear_models_test_result_summary.tex}}{\caption{}\label{sup:subfig:test_summary_lopo_linear}}
			\end{subfloatrow}
		}%
		{%
			\caption[Validation and testing performances]{%
				\textbf{Validation and testing performances.}
				Series of plots showing the performances on the validation sets (orange points) and testing sets (black points) for the models developed in this work.
				\subref{sup:subfig:test_summary_naive} Naive single protein models.
				\subref{sup:subfig:test_summary_by_position} Single protein models trained by segregating protein positions.
				\subref{sup:subfig:test_summary_lopo_xgb} General gradient boosted tree models trained in a Leave-One-Protein-Out (LOPO) fashion.
				\subref{sup:subfig:test_summary_lopo_linear} General linear regression models trained in a Leave-One-Protein-Out (LOPO) fashion.
			}\label{sup:fig:test_summary}%
		}%
	\end{figure}

	\begin{figure}
		\ffigbox[\FBwidth]{\input{./tikz/single_protein_models_naive_test_result_correlations.tex}}{%
			\caption[Prediction correlations for naive single protein models]{%
				\textbf{Prediction correlations for naive single protein models.}
				Series of scatter plots showing the correlations on the test set between the experimental fitness score and the predicted fitness score for the nine datasets used in this work.
				The predictions were obtained with independent gradient boosted tree models for each dataset.
				The validation and testing procedure followed the naive approach described in \cref{sec:mm_single_protein_models}.
				Orange crosses are synonymous mutations.
				Black crosses are missense mutations.
			}\label{sup:fig:single_protein_models_naive_test_result_correlations}%
		}%
	\end{figure}

	\begin{figure}
		\ffigbox[\FBwidth]{\input{./tikz/single_protein_models_by_position_test_result_correlations.tex}}{%
			\caption[Prediction correlations for single protein models trained by segregating protein positions]{%
				\textbf{Prediction correlations for single protein models trained by segregating protein positions.}
				Series of scatter plots showing the correlations on the test set between the experimental fitness score and the predicted fitness score for the nine datasets used in this work.
				The predictions were obtained with independent gradient boosted tree models for each dataset.
				The validation and testing procedure followed the naive approach described in \cref{sec:mm_single_protein_models}.
				Orange crosses are synonymous mutations.
				Black crosses are missense mutations.
			}\label{sup:fig:single_protein_models_by_position_test_result_correlations}%
		}%
	\end{figure}

	\begin{figure}
		\ffigbox[\FBwidth]{\input{./tikz/single_protein_models_by_position_test_result_correlations.tex}}{%
			\caption[Prediction correlations for single protein models trained by segregating protein positions]{%
				\textbf{Prediction correlations for the gradient boosted tree general models.}
				Series of scatter plots showing the correlations on the test set between the experimental fitness score and the predicted fitness score for the nine datasets used in this work.
				The validation and testing procedure followed the naive approach described in \cref{sec:mm_general_models}.
				Orange crosses are synonymous mutations.
				Black crosses are missense mutations.
			}\label{sup:fig:lopo_xgb_model_test_result_correlations}%
		}%
	\end{figure}

	\begin{figure}
		\ffigbox[\FBwidth]{\input{./tikz/single_protein_models_naive_random_search.tex}}{%
			\caption[Random hyperparameter search results for naive single protein models]{%
				\textbf{Random hyperparameter search results for naive single protein models.}
				Series of scatter plots showing the maximum average Pearson correlation coefficient for different values of the hyperparameters tested in cross-validation with a random search strategy.
				The Pearson correlation coefficient between the true fitness scores and the predicted fitness scores on the validation set was calculated independently for each dataset and each hyperparameter combination.
				The results were averaged across datasets, such that a single average Pearson r was obtained for each hyperparameter combination.
				The plotted quantities correspond to the maximum across all the random search iterations of those Pearson r averages, for a given hyperparameter value.
				The orange vertical line shows the chosen value for each hyperparameter, the value that was used in the final models.
				Some of the hyperparameter ranges are shown in logarithmic scale for ease of visualization.
				For the L1 regularization hyperparameter in logarithmic scale, the chosen value is \num{0}, and it cannot be shown on a logarithmic scale.
			}\label{sup:fig:single_protein_models_naive_random_search}%
		}%
	\end{figure}

	\begin{figure}
		\ffigbox[\FBwidth]{\input{./tikz/single_protein_models_by_position_random_search.tex}}{%
			\caption[Random hyperparameter search results for the single protein models trained by segregating protein positions]{%
				\textbf{Random hyperparameter search results for the single protein models trained by segregating protein positions.}
				Series of scatter plots showing the maximum average Pearson correlation coefficient for different values of the hyperparameters tested in cross-validation with a random search strategy.
				The Pearson correlation coefficient between the true fitness scores and the predicted fitness scores on the validation set was calculated independently for each dataset and each hyperparameter combination.
				The results were averaged across datasets, such that a single average Pearson r was obtained for each hyperparameter combination.
				The plotted quantities correspond to the maximum across all the random search iterations of those Pearson r averages, for a given hyperparameter value.
				The orange vertical line shows the chosen value for each hyperparameter, the value that was used in the final models.
				Some of the hyperparameter ranges are shown in logarithmic scale for ease of visualization.
			}\label{sup:fig:single_protein_models_by_position_random_search}%
		}%
	\end{figure}

	\begin{figure}
		\ffigbox[\FBwidth]{\input{./tikz/lopo_models_xgb_random_search.tex}}{%
			\caption[Random hyperparameter search results for the gradient boosted trees general models]{%
				\textbf{Random hyperparameter search results for the gradient boosted trees general models.}
				Series of scatter plots showing the maximum average Spearman correlation coefficient for different values of the hyperparameters tested in cross-validation with a random search strategy.
				The Spearman correlation coefficient between the true fitness scores and the predicted fitness scores on the validation set was calculated independently for each dataset and each hyperparameter combination.
				The results were averaged across datasets, such that a single average Pearson r was obtained for each hyperparameter combination.
				The plotted quantities correspond to the maximum across all the random search iterations of those averages, for a given hyperparameter value.
				The orange vertical line shows the chosen value for each hyperparameter, the value that was used in the final models.
				Some of the hyperparameter ranges are shown in logarithmic scale for ease of visualization.
				For the L1 regularization hyperparameter in logarithmic scale, the chosen value is \num{0}, and it cannot be shown on a logarithmic scale.
			}\label{sup:fig:lopo_xgb_model_random_search}%
		}%
	\end{figure}

	\begin{figure}
		\ffigbox[\FBwidth]{\input{./tikz/single_protein models_naive_feature_importance_by_dataset.tex}}{%
			\caption[Feature importance for the naive single protein models]{%
				\textbf{Feature importance for the naive single protein models.}
				Series of bar plots showing the grouped permutation importance of the features used in the single protein models trained with the naive approach, subdivided by dataset.
			}\label{sup:fig:feature_importance_single_protein_naive}%
		}%
	\end{figure}

	\begin{figure}
		\ffigbox[\FBwidth]{\input{./tikz/single_protein_models_by_position_feature_importance_by_dataset.tex}}{%
			\caption[Feature importance for the single protein models trained by segregating protein positions]{%
				\textbf{Feature importance for the single protein models trained by segregating protein positions}
				Series of bar plots showing the grouped permutation importance of the features used in the single protein models trained by segregating protein positions, subdivided by dataset.
			}\label{sup:fig:feature_importance_single_protein_by_position}%
		}%
	\end{figure}
\end{appendices}
{%
\hypersetup{linkcolor=.}%
\listoffigures%
\addcontentsline{toc}{chapter}{List of Figures}%
\listoftables%
\addcontentsline{toc}{chapter}{List of Tables}%
}%
